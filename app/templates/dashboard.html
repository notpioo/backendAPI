
{% extends "base.html" %}

{% block title %}Dashboard - Chatbot Admin{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% block content %}
<div class="stats-grid">
    <div class="stat-card">
        <h3>Total Knowledge</h3>
        <div class="stat-value">{{ stats.total_knowledge or 0 }}</div>
    </div>
    
    <div class="stat-card">
        <h3>API Response Count</h3>
        <div class="stat-value">0</div>
    </div>
    
    <div class="stat-card">
        <h3>API Status</h3>
        <div class="stat-value online-status">Online</div>
    </div>
</div>

<div class="announcement-section">
    <div class="announcement-header">
        <h2 id="announcementTitle">Announcement</h2>
        <a href="{{ url_for('admin.announcement') }}" class="btn">View Changes</a>
    </div>
    <div class="announcement-content" id="announcementContent">
        Loading announcement...
    </div>
    <div id="lastUpdated" style="color: #68d391; font-size: 0.875rem; margin-top: 10px;"></div>
</div>

<script>
// Load announcement on page load
document.addEventListener('DOMContentLoaded', function() {
    loadAnnouncement();
});

function loadAnnouncement() {
    fetch('/api/announcement/')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                document.getElementById('announcementTitle').textContent = data.data.title;
                document.getElementById('announcementContent').textContent = data.data.message;
                
                if (data.data.updated_at) {
                    const updatedDate = new Date(data.data.updated_at);
                    const formattedDate = updatedDate.toLocaleDateString('id-ID', {
                        day: 'numeric',
                        month: 'long',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    document.getElementById('lastUpdated').textContent = `Last updated: ${formattedDate}`;
                }
            } else {
                document.getElementById('announcementContent').textContent = "We've updated the chatbot's knowledge base with the latest information. Please review the changes and provide feedback.";
            }
        })
        .catch(error => {
            console.error('Error loading announcement:', error);
            document.getElementById('announcementContent').textContent = "We've updated the chatbot's knowledge base with the latest information. Please review the changes and provide feedback.";
        });
}
</script>
{% endblock %}
